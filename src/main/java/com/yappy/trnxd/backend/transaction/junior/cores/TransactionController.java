package com.yappy.trnxd.backend.transaction.junior.cores;import com.fasterxml.jackson.databind.ObjectMapper;import com.yappy.trnxd.backend.transaction.junior.cross_model.adapter.repository.MerchantRepository;import com.yappy.trnxd.backend.transaction.junior.cross_model.adapter.repository.entities.BusinessEntity;import com.yappy.trnxd.backend.transaction.junior.cross_model.enums.OperationTypeEnum;import com.yappy.trnxd.backend.transaction.junior.cross_model.enums.TransactionStatusEnum;import com.yappy.trnxd.backend.transaction.junior.cross_model.enums.TransactionTypeEnum;import com.yappy.trnxd.backend.transaction.junior.cross_model.model.BeginP2PTransactionDTO;import com.yappy.trnxd.backend.transaction.junior.cross_model.model.TransactionRequestEntity;import com.yappy.trnxd.backend.transaction.junior.library.config.KafkaTopicConfiguration;import com.yappy.trnxd.backend.transaction.junior.library.utils.CommonLogic;import io.swagger.v3.oas.annotations.Operation;import lombok.extern.slf4j.Slf4j;import org.apache.kafka.common.Uuid;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.http.MediaType;import org.springframework.kafka.core.KafkaTemplate;import org.springframework.web.bind.annotation.PostMapping;import org.springframework.web.bind.annotation.RequestBody;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;import java.math.BigDecimal;import java.util.List;@Slf4j@RestController@RequestMapping("/api/v1/transaction")public class TransactionController {    @Autowired    private KafkaTopicConfiguration kafkaTopicConfiguration;    @Autowired    private CommonLogic commonLogic;    @Autowired    private MerchantRepository merchantRepository;    @Autowired    private KafkaTemplate<String, Object> kafkaTemplate;    @Autowired    private ObjectMapper objectMapper;    @PostMapping(path = "/begin/p2p", produces = MediaType.APPLICATION_JSON_VALUE)    @Operation(summary = "Send Transaction")    public TransactionRequestEntity<BeginP2PTransactionDTO> sendTransaction(@RequestBody TransactionRequestEntity<BeginP2PTransactionDTO> request) {        var response = new TransactionRequestEntity<BeginP2PTransactionDTO>();        response.setBody(response.getBody());        response.setProfile(response.getProfile());        try {            log.info("El Mensaje será publicado en [{}]: {}", kafkaTopicConfiguration.getInterP2PBegin(), request);            kafkaTemplate.send(kafkaTopicConfiguration.getInterP2PBegin(), objectMapper.writeValueAsString(request));            log.info("El Mensaje se publicó en [{}]: {}", kafkaTopicConfiguration.getInterP2PBegin(), request);        } catch (Exception e) {            log.error("error al enviar el mensaje");        }        return response;    }    @PostMapping(path = "/begin/M2M", produces = MediaType.APPLICATION_JSON_VALUE)    @Operation(summary = "Send Transaction")    public TransactionRequestEntity<List<BusinessEntity>> getTransactions(@RequestBody TransactionRequestEntity<BeginP2PTransactionDTO> request) {        TransactionRequestEntity<List<BusinessEntity>> response = new TransactionRequestEntity<>();        response.setBody(response.getBody());        response.setProfile(response.getProfile());        try {            var entity = BusinessEntity.builder()                    .amount(new BigDecimal("21.56"))                    .cliUuid(Uuid.randomUuid().toString())                    .id(Uuid.randomUuid().toString())                    .operationType(OperationTypeEnum.DEBIT)                    .txnType(TransactionTypeEnum.M2M)                    .status(TransactionStatusEnum.IN_PROGRESS)                    .build();            var mapper = objectMapper.writeValueAsString(entity);            commonLogic.saveTransaction(merchantRepository::saveTransaction, mapper);            var transactions = commonLogic.fetchPaymentsByID(merchantRepository::findTransactionsByID, entity.getId());            response.setBody(transactions);        } catch (Exception e) {            e.fillInStackTrace();        }        return response;    }}